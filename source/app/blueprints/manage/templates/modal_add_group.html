<div class="modal-xl modal-dialog" role="document">
    <div class="modal-content" id="modal_access_control_content">
        <div class="modal-header">
            <h4 class="modal-title mt-2 mr-4">{% if not group.group_id %}Add Group {% else %} Edit {{ group.group_name }} {% endif %}</h4>
            <div class="row text-center mr-4">
                <ul class="nav nav-pills nav-default mr-4" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active show" data-toggle="pill" href="#group_details_tab" role="tab" aria-controls="group_details_tab" aria-selected="false">Info</a>
                    </li>
                    <li class="nav-item submenu">
                        <a class="nav-link"  data-toggle="pill" href="#group_members_tab" role="tab" aria-controls="group_members_tab" aria-selected="false">Members</a>
                    </li>
                </ul>
            </div>
            <div class="row text-right">
                <button type="button" class="pull-right btn bg-transparent" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true"><i class="fa fa-times"></i></span></button>
            </div>
        </div>
        <div class="modal-body">
            <div role="tabpanel">
                <div class="tab-content">
                    <div class="tab-pane active" id="group_details_tab">
                        <div class="container col-md-12" >
                            <form method="post" action="" id="form_new_group">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    {{ form.hidden_tag() }}
                                    <div class="form-group">
                                        <label for="group_name" class="mr-4">Group name *
                                        </label>
                                        {{ form.group_name(class='form-control',  autocomplete="off") }}
                                    </div>
                                    <div class="form-group mt-3">
                                        <label for="group_description" class="placeholder">Description *</label>
                                        {{ form.group_description(class='form-control',  autocomplete="off") }}
                                    </div>
                                    <div class="form-group" data-select2-id="7">
                                        <label>Permissions *</label>
                                        <div class="select2-input ml-12" data-select2-id="6">
                                            <select id="group_permissions" name="group_permissions" class="form-control select2-hidden-accessible ml-12" multiple="" data-select2-id="group_permissions" tabindex="-1" aria-hidden="true" style="width: 100%">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                {% if group.group_id %}
                                    <button type="button" class="btn btn-danger mt-5"
                                    onclick="delete_group('{{ group.group_id }}');">Delete</button>
                                    <button type="button" class="btn btn-outline-success ml-4 mt-5 float-right"
                                    id="submit_new_group">Update</button>
                                {% else %}

                                    <button type="button" class="btn btn-outline-success ml-4 mt-5 float-right"
                                    id="submit_new_group">Save</button>

                                {% endif %}
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane" id="group_members_tab">
                        <div class="container col-md-12" >
                            <div class="col" >
                              <div class="row d-flex">
                                <div class="col pull-right">
                                    <button class="btn btn-dark btn-sm pull-right" onclick="refresh_group_members({{ group.group_id }});">
                                        <span class="menu-title">Refresh</span>
                                    </button>
                                    <button class="btn btn-dark btn-sm pull-right" onclick="add_members_to_group({{ group.group_id }});">
                                        <span class="menu-title">Add member</span>
                                    </button>
                                </div>
                              </div>
                            </div>
                            <div class="row">
                              <table class="table display table-bordered table-striped table-hover responsive" width="100%" cellspacing="0" id="group_members_table" >
                                <thead>
                                  <tr>
                                      <th>User ID</th>
                                      <th>User login</th>
                                      <th>User display name</th>
                                  </tr>
                                </thead>
                                <tfoot>
                                  <tr>
                                      <th>User ID</th>
                                      <th>User login</th>
                                      <th>User display name</th>
                                  </tr>
                                </tfoot>
                              </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->
<script>
var data = [
    {% for e in all_perms %}
        {
            id: {{ e.value }},
            text: "{{ e.name }}"
        },
    {% endfor %}
];
$('#group_permissions').select2({ data: data });

{% if group.group_permissions_list %}

$('#group_permissions').val([
    {% for perm in group.group_permissions_list %} {{ perm.value }}, {% endfor %}
]);
$('#group_permissions').trigger('change');

{% endif %}

var modal_group_table = $("#group_members_table").DataTable({
        dom: 'Blfrtip',
        aaData: [],
        aoColumns: [
          {
            "data": "id",
            "render": function ( data, type, row ) {
                return `<i class="fa-solid fa-circle-minus mr-2 text-warning" style="cursor:pointer;" title="Remove from group" href="javascript:void(0)" onclick="remove_members_from_group('{{ group.group_id }}','${data}')"></i>${data}`;
            },
            "className": "dt-center"
        },
        {
            "data": "user",
            "className": "dt-center"
        },
        {
            "data": "name",
            "className": "dt-center"
        }
        ],
        filter: true,
        info: true,
        ordering: true,
        processing: true
});

modal_group_table.rows.add({{ group.group_members|tojson }});
modal_group_table.columns.adjust().draw();
</script>